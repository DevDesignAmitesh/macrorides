generator client {
  provider = "prisma-client"
  output   = "../generated/prisma"
  engineType = "binary"
}

datasource db {
  provider = "postgresql"
}

enum paymentAttemptStatus {
  CREATED
  REDIRECTED
  SUCCESS
  FAILED
}

enum paymentTargetType {
  RIDE
  FOOD_ORDER
  CLOTHING_ORDER
}

enum paymentFor {
  RIDE
  FOOD_ORDER
  CLOTHING_ORDER
}

enum deliveryStatus {
  CREATED
  DRIVER_ASSIGNED
  PICKUP_ARRIVED
  PICKED_UP
  OUT_FOR_DELIVERY
  DELIVERED
  CANCELLED
  FAILED
}

enum walletTxnType {
  CREDIT
  DEBIT
}

enum provider {
  CASHFREE
  RAZORPAY
  STRIPE
}

enum paymentStatus {
  INITIATED
  SUCCESS
  FAILED
  REFUNDED
}

enum clothingOrderStatus {
  CREATED
  PAID
  SHIPPED
  DELIVERED
  RETURN_REQUESTED
  RETURNED
  CANCELLED
}

enum orderStatus {
  CREATED
  CONFIRMED
  PREPARING
  OUT_FOR_DELIVERY
  DELIVERED
  CANCELLED
}

enum driverStatus {
  OFFLINE
  ONLINE
  ON_RIDE
  ON_DELIVERY
  SUSPENDED
}

enum rideStatus {
  REQUESTED
  ONGOING
  COMPLETED
  CANCELLED
}

enum vendorType {
  FOOD
  CLOTHING
}

enum kitchenState {
  OPEN
  CLOSED
  KITCHEN_BUSY
}

enum operationalState {
  OPEN
  CLOSED
  MAINTAINANCE
}

enum locationLabel {
  HOME
  WORK
  OUTLET
  PICKUP
  DROP
}

model Account {
  id         String  @id @default(uuid())
  phone      String  @unique
  email      String?
  name       String
  isVerified Boolean @default(false)

  customer    Customer?
  vendorOwner VendorOwner?
  driver      Driver?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Customer {
  id        String  @id @default(uuid())
  accountId String  @unique
  account   Account @relation(references: [id], fields: [accountId])

  location      UserSavedLocation[]
  ride          Ride[]
  foodOrder     FoodOrder[]
  clothingOrder ClothingOrder[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model VendorOwner {
  id        String  @id @default(uuid())

  accountId String  @unique
  account   Account @relation(references: [id], fields: [accountId])

  panNumber     String? @unique
  aadhaarNumber String? @unique

  vendor    Vendor[]
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Vendor {
  id            String     @id @default(uuid())
  outletName    String
  type          vendorType
  isVerified    Boolean    @default(false)
  gstNumber     String?
  contactNumber String    @unique
  openingTime  String?
  closingTime  String?
  is247        Boolean      @default(false)


  location   VendorSavedLocation[]
  closedDays ClosedDays[]
  categories Categories[]
  wallet     Wallet?

  ownerId String
  owner   VendorOwner @relation(references: [id], fields: [ownerId])

  foodVendor  FoodVendor?
  clothVendor ClothVendor?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model ClosedDays {
  id  String @id @default(uuid())
  day String

  vendorId String
  vendor   Vendor @relation(references: [id], fields: [vendorId])
}

model FoodVendor {
  id String @id @default(uuid())

  vendorId String @unique
  vendor   Vendor @relation(references: [id], fields: [vendorId])

  foodItem     FoodItem[]
  foodDelivery FoodDelivery[]
  foodOrder    FoodOrder[]

  fssaiNumber  String
  kitchenState kitchenState

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model ClothVendor {
  id String @id @default(uuid())

  vendorId String @unique
  vendor   Vendor @relation(references: [id], fields: [vendorId])

  clothingProduct ClothingProduct[]
  clothingOrder   ClothingOrder[]
  clothDelivery   ClothDelivery[]

  returnPolicy     String
  operationalState operationalState

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Driver {
  id         String  @id @default(uuid())
  isVerified Boolean

  accountId String  @unique
  account   Account @relation(references: [id], fields: [accountId])

  ride          Ride[]
  foodDelivery  FoodDelivery[]
  clothDelivery ClothDelivery[]
  location      DriverLocation?
  wallet        Wallet?
  status        DriverStatus?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model DriverStatus {
  id String @id @default(uuid())

  driverId String @unique
  driver   Driver @relation(references: [id], fields: [driverId])

  status driverStatus

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Location {
  id        String        @id @default(uuid())
  latitude  Float
  longitude Float
  address   String
  label     locationLabel

  UserSavedLocation   UserSavedLocation[]
  clothingOrder       ClothingOrder[]
  VendorSavedLocation VendorSavedLocation[]

  deliveryLocation FoodOrder[] @relation("deliveryLocation")
  pickupLocation   Ride[]      @relation("pickupLocation")
  dropLocation     Ride[]      @relation("dropLocation")

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model UserSavedLocation {
  id String @id @default(uuid())

  customerId String
  customer   Customer @relation(references: [id], fields: [customerId])

  locationId String
  location   Location @relation(references: [id], fields: [locationId])

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model VendorSavedLocation {
  id           String @id @default(uuid())
  
  // this will come from that particular vendor for which we are adding or updating
  contactPhone String 

  locationId String
  location   Location @relation(references: [id], fields: [locationId])

  vendorId String
  vendor   Vendor @relation(references: [id], fields: [vendorId])

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model DriverLocation {
  id String @id @default(uuid())

  driverId String @unique
  driver   Driver @relation(references: [id], fields: [driverId])

  latitude  Float
  longitude Float

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Categories {
  id   String @id @default(uuid())
  name String

  vendorId String
  vendor   Vendor @relation(references: [id], fields: [vendorId])

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Ride {
  id String @id @default(uuid())

  customerId String
  customer   Customer @relation(references: [id], fields: [customerId])

  driverId String?
  driver   Driver? @relation(references: [id], fields: [driverId])

  status rideStatus

  payment PaymentTarget[]

  pickupLocationId String
  pickupLocation   Location @relation("pickupLocation", references: [id], fields: [pickupLocationId])

  dropLocationId String
  dropLocation   Location @relation("dropLocation", references: [id], fields: [dropLocationId])

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model FoodOrder {
  id String @id @default(uuid())

  customerId String
  customer   Customer @relation(references: [id], fields: [customerId])

  foodVendorId String
  foodVendor   FoodVendor @relation(references: [id], fields: [foodVendorId])

  deliveryLocationId String
  deliveryLocation   Location @relation("deliveryLocation", references: [id], fields: [deliveryLocationId])

  status       orderStatus
  foodDelivery FoodDelivery[]
  items        FoodOrderItem[]
  payment      PaymentTarget[]
  totalAmount  Float

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model ClothingOrder {
  id String @id @default(uuid())

  customerId String
  customer   Customer @relation(references: [id], fields: [customerId])

  clothVendorId String
  clothVendor   ClothVendor @relation(references: [id], fields: [clothVendorId])

  deliveryLocationId String
  deliveryLocation   Location @relation(references: [id], fields: [deliveryLocationId])

  status        clothingOrderStatus
  items         ClothingOrderItem[]
  clothDelivery ClothDelivery[]
  payment       PaymentTarget[]
  totalAmount   Float

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model FoodDelivery {
  id String @id @default(uuid())

  foodOrderId String
  foodOrder   FoodOrder @relation(references: [id], fields: [foodOrderId])

  foodVendorId String
  foodVendor   FoodVendor @relation(references: [id], fields: [foodVendorId])

  driverId String?
  driver   Driver? @relation(references: [id], fields: [driverId])

  status deliveryStatus

  items FoodOrderItem[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model ClothDelivery {
  id String @id @default(uuid())

  clothOrderId String
  clothOrder   ClothingOrder @relation(references: [id], fields: [clothOrderId])

  clothVendorId String
  clothVendor   ClothVendor @relation(references: [id], fields: [clothVendorId])

  driverId String?
  driver   Driver? @relation(references: [id], fields: [driverId])

  status deliveryStatus

  items ClothingOrderItem[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Payment {
  id String @id @default(uuid())

  amount   Float
  currency String @default("INR")

  status   paymentStatus
  provider provider

  providerOrderId   String
  providerPaymentId String?
  providerSessionId String?

  target PaymentTarget?

  attempts PaymentAttempt[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model PaymentTarget {
  id String @id @default(uuid())

  paymentId String  @unique
  payment   Payment @relation(references: [id], fields: [paymentId])

  type paymentTargetType

  rideId          String?
  foodOrderId     String?
  clothingOrderId String?

  ride          Ride?          @relation(references: [id], fields: [rideId])
  foodOrder     FoodOrder?     @relation(references: [id], fields: [foodOrderId])
  clothingOrder ClothingOrder? @relation(references: [id], fields: [clothingOrderId])

  createdAt DateTime @default(now())
}

model PaymentAttempt {
  id String @id @default(uuid())

  paymentId String
  payment   Payment @relation(references: [id], fields: [paymentId])

  status paymentAttemptStatus
  error  String?

  rawPayload Json?

  createdAt DateTime @default(now())
}

model Wallet {
  id String @id @default(uuid())

  driverId String? @unique
  driver   Driver? @relation(references: [id], fields: [driverId])

  vendorId String? @unique
  vendor   Vendor? @relation(references: [id], fields: [vendorId])

  balance Float

  transactions WalletTransaction[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model WalletTransaction {
  id String @id @default(uuid())

  walletId String
  wallet   Wallet @relation(references: [id], fields: [walletId])

  type   walletTxnType
  amount Float
  reason String

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model FoodItem {
  id String @id @default(uuid())

  foodVendorId String
  foodVendor   FoodVendor @relation(references: [id], fields: [foodVendorId])

  name        String
  description String?
  price       Float
  imageUrl    String?

  foodOrderItem FoodOrderItem[]

  isAvailable Boolean @default(true)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model FoodOrderItem {
  id String @id @default(uuid())

  orderId String
  order   FoodOrder @relation(references: [id], fields: [orderId])

  foodItemId String?
  foodItem   FoodItem? @relation(references: [id], fields: [foodItemId])

  deliveryId String?
  delivery   FoodDelivery? @relation(references: [id], fields: [deliveryId])

  name     String
  quantity Int
  price    Float

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model ClothingProduct {
  id String @id @default(uuid())

  clothVendorId String
  clothVendor   ClothVendor @relation(references: [id], fields: [clothVendorId])

  name        String
  description String?
  brand       String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  variants ClothingVariant[]
}

model ClothingVariant {
  id String @id @default(uuid())

  productId String
  product   ClothingProduct @relation(references: [id], fields: [productId])

  size  String
  color String

  price    Float
  stockQty Int

  clothingOrderItem ClothingOrderItem[]

  sku String @unique // this we will create in-house

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model ClothingOrderItem {
  id String @id @default(uuid())

  orderId String
  order   ClothingOrder @relation(references: [id], fields: [orderId])

  deliveryId String
  delivery   ClothDelivery @relation(references: [id], fields: [deliveryId])

  variantId String?
  variant   ClothingVariant? @relation(references: [id], fields: [variantId])

  productName String
  size        String
  color       String
  quantity    Int
  price       Float

  createdAt DateTime @default(now())
}
